<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bootstrap Pos-Customer Form</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="stylesheet" href="assets/fonts/css/all.css">
    <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-utilities.css">
    <link rel="stylesheet" href="assets/normalize.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-gradient">
    <div class="container-fluid">
        <a class="navbar-brand text-danger" href="#">Jayawin Pos System</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a  id="home" class="nav-link" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a  id="item" class="nav-link" aria-current="page" href="#">Item</a>
                </li>
                <li class="nav-item">
                    <a  id="customer" class="nav-link" href="#">Customer</a>
                </li>
                <li class="nav-item">
                    <a id="order" class="nav-link" href="#">Orders</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Others
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#">Discounts</a></li>
                        <li><a class="dropdown-item" href="#">Careers</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">About Us</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <form class="d-flex">
        <button type="button" class="btn btn-outline-dark me-2"><i class="fas fa-user-plus"></i> Sign Up</button>
        <button type="button" class="btn btn-outline-dark me-2 "><i class="fas fa-sign-in-alt"></i> Log Out</button>
    </form>
</nav>

<!--DashBoard-->
<div id="db" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="assets/images/image_01.jpg" class="d-block w-100" alt="..." style="height: 660px">
        </div>
        <div class="carousel-item">
            <img src="assets/images/image_02.jpg" class="d-block w-100" alt="..." style="height: 660px">
        </div>
        <div class="carousel-item">
            <img src="assets/images/image_03.jpg" class="d-block w-100" alt="..." style="height: 660px">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
<!--Customer-->
<section id="cu" class="container-fluid bg-light ">
    <div class="row">
        <div class="col pb-4 pt-5">
            <section class="container-fluid bg-gradient">
                <div class="row bg-gradient "><h4>Save Customer</h4></div>
                <div class="row bg-gradient">
                    <form class="mt-4 mb-4 w-100" >
                        <input id="search" class="form-control w-50 col-sm-5 " type="search" placeholder="Search/Delete" aria-label="Search">
                    </form>
                </div>
                <div class="row bg-gradient">
                    <div class="col-3 pb-5">
                        <button id="searchButton" type="button" class="btn bg-success  w-100 m-2">Search</button>
                    </div>
                    <div class="mb-1">
                        <button id="ClearSearch" type="button" class="btn btn-primary ">Clear</button>
                        <button id="DeleteCustomer" type="button" class="btn btn-danger ">Delete</button>
                        <button id="UpdateCustomer" type="button" class="btn btn-secondary ">Update</button>
                    </div>
                </div>
            </section>
        </div>
        <div class="col-6 pt-5">
            <div class="mb-3">
                <label class="form-label" for="txtCustId">Customer ID</label>
                <input class="form-control w-50" id="txtCustId" placeholder="Customer ID" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustName">Customer Name</label>
                <input class="form-control w-50" id="txtCustName" placeholder="Customer Name" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustAddress">Customer Address</label>
                <input class="form-control w-50" id="txtCustAddress" placeholder="Customer Address" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtCustSalary">Customer Salary</label>
                <input class="form-control w-50" id="txtCustSalary" placeholder="Customer Salary" type="text">
            </div>
            <div class="mb-3">
                <button id="btnSaveOrUpdate" type="button" class="btn btn-primary" >Save</button>
                <button id="clearCustomer" type="button" class="btn btn-outline-primary">Clear</button>
            </div>
        </div>
    </div>

    <div class="row pb-5">
        <table class="table">
            <thead class="table-active">
            <tr>
                <th scope="col">Customer ID</th>
                <th scope="col">Name</th>
                <th scope="col">Address</th>
                <th scope="col">Salary</th>
            </tr>
            </thead>
            <tbody id="customerTable">

            </tbody>
        </table>
    </div>
</section>
<!--Item-->
<section id="it" class="container-fluid bg-light ">
    <div class="row">
        <div class="col pb-9 pt-2">
            <section class="container-fluid bg-gradient pt-3">
                <div class="row w-50 bg-gradient"><h4>Save Item</h4></div>
                <div class="row bg-gradient">
                    <form class="mt-4 mb-4 w-100" >
                        <input id="itemsearch" class="form-control w-50" type="search" placeholder="Search/Delete" aria-label="Search">
                    </form>
                </div>
                <div class="row bg-gradient">
                    <div class="col-6 pb-5">
                        <button id="btnsearchItem" type="button" class="btn bg-success w-100">Search</button>
                    </div>
                    <div class="mb-1">
                        <button id="ClearItem" type="button" class="btn btn-primary ">Clear</button>
                        <button id="DeleteItem" type="button" class="btn btn-danger ">Delete</button>
                        <button id="UpdateItem" type="button" class="btn btn-secondary ">Update</button>
                    </div>
                </div>
            </section>
        </div>
        <div class="col-6 pt-5">
            <div class="mb-3">
                <label class="form-label" for="txtItemId">Item ID</label>
                <input class="form-control w-50" id="txtItemId" placeholder="Item ID" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtItemName">Item Name</label>
                <input class="form-control w-50" id="txtItemName" placeholder="Item Name" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtItemPrice">Item Price</label>
                <input class="form-control w-50" id="txtItemPrice" placeholder="Item Price" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label" for="txtItemQty">Item Qty</label>
                <input class="form-control w-50" id="txtItemQty" placeholder="Item Qty" type="text">
            </div>
            <div class="mb-3">
                <button id="btnsaveItem" type="button" class="btn btn-primary" >Save</button>
                <button id="clear" type="button" class="btn btn-outline-primary">Clear</button>
            </div>
        </div>
    </div>

    <div class="row pb-5">
        <table class="table">
            <thead class="table-active">
            <tr>
                <th scope="col">Item ID</th>
                <th scope="col">Item Name</th>
                <th scope="col">Price</th>
                <th scope="col">Qty</th>
            </tr>
            </thead>
            <tbody id="itemTable">

            </tbody>
        </table>
    </div>
</section>
<!--Orders-->
<section id="or"  class="container-fluid bg-light">

    <section class="row">

        <div class="col bg-gradient m-4 pb-4">


            <section class="container">

                <div class="row">
                    <div class="bg-info mb-3 p-2"><h4>Bill Details</h4></div>
                    <div class="col">
                        <caption>Order ID:</caption>
                        <form>
                            <input id="txtO_Id" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <caption>Order Date:</caption>
                        <form>
                            <input id="txtO_Date" class="form-control " type="text">
                        </form>
                    </div>

                </div>

                <div class="row">
                    <div class="col">
                        <caption>Customer_ID:</caption>
                        <form>
                            <input id="txtC_Id" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <button id="btnEnterCustomer" class="btn btn-primary mt-4">Enter</button>
                    </div>

                </div>
                <div class="row">
                    <div class="col">
                        <caption>Name:</caption>
                        <form>
                            <input id="txtC_Name" class="form-control " type="text">
                        </form>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <caption>Address:</caption>
                        <form>
                            <input id="txtC_Address" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <caption>Salary:</caption>
                        <form>
                            <input id="txtC_Salary" class="form-control " type="text">
                        </form>
                    </div>

                </div>

            </section>
        </div>

        <div class="col bg-gradient m-4 pb-4">

            <section class="container">

                <div class="row">
                    <div class="bg-info mb-3 p-2"><h4>Item Details</h4></div>
                    <div class="col">
                        <caption>Item Id:</caption>
                        <form>
                            <input id="txtI_Id" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <button id="btnEnterItem" class="btn btn-primary mt-4">Enter</button>
                    </div>

                </div>
                <div class="row">
                    <div class="col">
                        <caption>Item Name:</caption>
                        <form>
                            <input id="txtI_Name" class="form-control " type="text">
                        </form>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <caption>Item Price:</caption>
                        <form>
                            <input id="txtI_Price" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <caption>QtyOnH:</caption>
                        <form>
                            <input id="txtI_Qoh" class="form-control " type="text">
                        </form>
                    </div>

                </div>

                <div class="row">
                    <div class="col">
                        <caption>Order QTY:</caption>
                        <form>
                            <input id="txtI_Qty" class="form-control " type="text">
                        </form>
                    </div>
                </div>


                <div class="row">
                    <div class="col">
                        <button id="btnAddItem" class="btn btn-success mt-4">Add Item</button>
                        <button id="btnClearTable" class="btn btn-danger mt-4">Clear Table</button>

                    </div>
                </div>
            </section>
        </div>


        <div class="col bg-gradient m-4 pb-4">
            <div class="row">
                <h4  class="text-secondary">Total </h4>
                <h4 id="lblTotal" class="text-secondary"> </h4>

               <!-- <form>
                    <input id="lblTotal" class="form-control " type="text">
                </form>-->
            </div>


            <section class="container">

                <div class="row">
                    <div class="col">
                        <caption>Payment:</caption>
                        <form>
                            <input id="txtPayment" class="form-control " type="text">
                        </form>
                    </div>
                    <div class="col">
                        <caption>Discount:</caption>
                        <form>
                            <input id="txtDiscount" class="form-control " type="text">
                        </form>
                    </div>
                </div>


                <div class="row">
                    <div CLASS="col">
                        <caption>Balance:</caption>
                        <form>
                            <input id="txtBalance" class="form-control " type="text">
                        </form>
                    </div>
                </div>


                <div class="row">
                    <div class="col">
                        <button id="btnPlaceOrder" class="btn btn-success mt-4">Place Order</button>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <!--Table-->
    <section class="row p-3 mb-5">
        <div class="col">
            <table class="table">
                <thead class="bg-info">
                <tr>
                    <th scope="col">Item ID</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Qty</th>
                    <th scope="col">Price</th>
                </tr>
                </thead>
                <tbody id="OrderTable">

                </tbody>
            </table>
        </div>

    </section>
</section>

<script src="assets/jQuery/jquery-3.6.0.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="db/db.js"></script>
<script src="controller/CustomerController.js"></script>
<script src="model/CustomerDto.js"></script>
<script src="controller/ItemController.js"></script>
<script src="model/ItemDto.js"></script>
<script src="controller/OrderController.js"></script>
<script src="model/ItemDetailsDto.js"></script>
<script src="controller/OrderDetailsController.js"></script>
<script src="model/OrderDto.js"></script>

<script>
    $("#db").css("display","block");
    $("#cu").css("display","none");
    $("#it").css("display","none");
    $("#or").css("display","none");

    $("#customer").click(function (){
        $("#cu").css("display","block");
        $("#db").css("display","none");
        $("#it").css("display","none");
        $("#or").css("display","none");
        loadallCustomers();

    });
    $("#item").click(function (){
        $("#it").css("display","block");
        $("#cu").css("display","none");
        $("#or").css("display","none");
        $("#db").css("display","none");

        loadallItems();

    });
    $("#order").click(function (){
        $("#or").css("display","block");
        $("#it").css("display","none");
        $("#cu").css("display","none");
        $("#db").css("display","none");
    });
    $("#home").click(function (){
        $("#db").css("display","block");
        $("#it").css("display","none");
        $("#cu").css("display","none");
        $("#or").css("display","none");
    });

    //----------------Validate Customer-----------------------------------------------------------
  //  $("#btnSaveOrUpdate").attr('disabled','disabled');

    var idPattern = /^[C](-00)[0-9]{1,4}$/;
    var namePattern =/^[A-z0-9 ]{3,}$/;
    var addressPattern =/^[A-z0-9 ]{3,}$/;
    var salaryPattern=/^[0-9]+$/;

/*
    $("#txtCustId").keyup(function (eventOb) {
        if (idPattern.test($("#txtCustId").val())){
            $("#txtCustId").css("border","2px solid green");
            if (eventOb.key == "Enter") {
                $("#txtCustName").focus();

                $("#txtCustName").keyup(function (eventOb) {
                    if (namePattern.test($("#txtCustName").val())){
                        $("#txtCustName").css("border","2px solid green");
                        if (eventOb.key == "Enter") {
                            $("#txtCustAddress").focus();

                            $("#txtCustAddress").keyup(function (eventOb) {
                                if (addressPattern.test($("#txtCustAddress").val())){
                                    $("#txtCustAddress").css("border","2px solid green");
                                    if (eventOb.key == "Enter") {
                                        $("#txtCustSalary").focus();

                                        $("#txtCustSalary").keyup(function (eventOb) {
                                            if (salaryPattern.test($("#txtCustSalary").val())){
                                                $("#txtCustSalary").css("border","2px solid green");
                                                $("#btnSaveOrUpdate").removeAttr('disabled');
                                                if (eventOb.key == "Enter") {
                                                    $("#btnSaveOrUpdate").focus();
                                                }
                                            }else{
                                                $("#txtCustSalary").css("border","2px solid red");
                                                $("#btnSaveOrUpdate").attr('disabled','disabled');
                                            }
                                        });

                                    }
                                }else{
                                    $("#txtCustAddress").css("border","2px solid red");
                                    $("#btnSaveOrUpdate").attr('disabled','disabled');
                                }
                            });


                        }
                    }else{
                        $("#txtCustName").css("border","2px solid red");
                        $("#btnSaveOrUpdate").attr('disabled','disabled');
                    }
                });


            }
        }else{
            $("#txtCustId").css("border","2px solid red");
            $("#btnSaveOrUpdate").attr('disabled','disabled');
        }
    });
*/

    //----------------------Customer--------------------------------------------------------------

        $("#btnSaveOrUpdate").click(function () {
            let customerID = $("#txtCustId").val();
            let customerName = $("#txtCustName").val();
            let customerAddress = $("#txtCustAddress").val();
            let customerSalary = $("#txtCustSalary").val();

            var customer=new CustomerDto(customerID,customerName,customerAddress,customerSalary);

            saveCustomer(customer);
            clearAll();
            loadallCustomers();
          //  $("#btnSaveOrUpdate").attr('disabled','disabled');
        });
        $("#searchButton").click(function () {
            var searchID = $("#search").val();
            var response = searchCustomer(searchID);
            if (response) {
                $("#txtCustId").val(response.id);
                $("#txtCustName").val(response.name);
                $("#txtCustAddress").val(response.address);
                $("#txtCustSalary").val(response.salary);
            }else{
                clearAll();
                alert("No Customer");
            }
        });
        $("#clearCustomer").click(function () {
        clearAll();
    });
        $("#ClearSearch").click(function () {
            clearAll();
        });
        $("#DeleteCustomer").click(function () {
            var D_id = $("#search").val();
            deleteCustomer(D_id);
            clearAll();
            loadallCustomers();
         });
        $("#UpdateCustomer").click(function () {
            let customerID = $("#txtCustId").val();
            let customerName = $("#txtCustName").val();
            let customerAddress = $("#txtCustAddress").val();
            let customerSalary = $("#txtCustSalary").val();

            var cust=new CustomerDto(customerID,customerName,customerAddress,customerSalary);

            updateCustomer(cust);
        clearAll();
        loadallCustomers();
    });

    //----------------Validate Item---------------------------------------------------------------
    let allValidators = [];
    //Regular expression
    var itemCodeRegEx = /^(I00-)[0-9]{3}$/;
    var itemNameRegEx = /^[A-z ]{4,}$/;
    var itemUnitPriceRegEx = /^[0-9]{1,}[.]?[0-9]{1,2}$/;
    var itemQtyOnHandRegEx = /^[0-9]{1,}[.]?[0-9]{1,2}$/;


    allValidators.push([itemCodeRegEx, $("#txtItemId")]);
    allValidators.push([itemNameRegEx, $("#txtItemName")]);
    allValidators.push([itemQtyOnHandRegEx, $("#txtItemPrice")]);
    allValidators.push([itemUnitPriceRegEx, $("#txtItemQty")]);



    $("#txtItemId,#txtItemName,#txtItemPrice,#txtItemQty").on('keyup', function (e) {
        validateText(allValidators, e.key);
    });

    setDisableAllText(allValidators);

    function validateText(expression, key) {
        for (let i = 0; i < expression.length; i++) {
            var regEx = expression[i][0];
            var input = expression[i][1];

            //check whether someone type in the text field
            if (input.val().length >= 1) {
                if (regEx.test(input.val())) {
                    input.css("border", '2px solid green');
                    if (key == "Enter") {
                        expression[i + 1][1].attr('disabled', false);
                        expression[i + 1][1].focus();
                    }
                } else {
                    input.css("border", '2px solid red');
                }
            } else {
                input.css("border", '1px solid #ced4da');
            }
        }
    }

    function setDisableAllText(expression) {
        $("#btnsaveItem").attr("disabled", true);
        for (let i = 0; i < expression.length; i++) {
            var input = expression[i+1][1];
            input.attr('disabled', true);
        }

    }


    //---------------Item----------------------------------------------------------------------

            $("#btnsaveItem").click(function () {
                let itemId = $("#txtItemId").val();
                let itemName = $("#txtItemName").val();
                let itemQty = $("#txtItemQty").val();
                let itemPrice = $("#txtItemPrice").val();

                var item=new ItemDto(itemId,itemName,itemPrice,itemQty);

                saveItem(item);
                clearAllItems();
                loadallItems();
              //  $("#btnsaveItem").attr('disabled','disabled');
            });
            $("#btnsearchItem").click(function () {
                var searchID = $("#itemsearch").val();
                var response = searchItem(searchID);
                if (response) {
                    $("#txtItemId").val(response.id);
                    $("#txtItemName").val(response.name);
                    $("#txtItemPrice").val(response.price);
                    $("#txtItemQty").val(response.qty);
                }else{
                    clearAllItems();
                    alert("No item");
                }
            });
            $("#Clear").click(function () {
                clearAllItems();
            });
            $("#ClearItem").click(function () {
                clearAllItems();
            });
            $("#DeleteItem").click(function () {
                var D_id = $("#itemsearch").val();
                deleteItem(D_id);
                clearAllItems();
                loadallItems();
            });
            $("#UpdateItem").click(function () {
                let itemId = $("#txtItemId").val();
                let itemName = $("#txtItemName").val();
                let itemQty = $("#txtItemQty").val();
                let itemPrice = $("#txtItemPrice").val();

                var item=new ItemDto(itemId,itemName,itemPrice,itemQty);

                updateItem(item);
                clearAllItems();
                loadallItems();
            });

    //-----------Validate Orders------------------------------------------------------------




    //----------------Orders-----------------------------------------------------------------
    $("#btnEnterCustomer").click(function () {
        var searchID = $("#txtC_Id").val();
        var response = searchCustomer(searchID);
        if (response) {
            $("#txtC_Name").val(response.name);
            $("#txtC_Address").val(response.address);
            $("#txtC_Salary").val(response.salary);
        }else{
            clearAll();
            alert("Wrong Customer Id.");
        }
    });
    $("#btnEnterItem").click(function () {
        var searchID = $("#txtI_Id").val();
        var response = searchItem(searchID);
        if (response) {
            $("#txtI_Name").val(response.name);
            $("#txtI_Price").val(response.price);
            $("#txtI_Qoh").val(response.qty);
        }else{
            clearAll();
            alert("Wrong Item Id.");
        }
    });
    let total=0;
    $("#btnAddItem").click(function () {
        let orderId=$("#txtO_Id").val();
        let itemId = $("#txtI_Id").val();
        let itemName = $("#txtI_Name").val();
        let qty = $("#txtI_Qty").val();
        let qoh=$("#txtI_Qoh").val();
        let price=(($("#txtI_Price").val())*(qty));

        var itemdetails=new ItemDetailsDto(orderId,itemId,itemName,qty,qoh,price);

        itemList.push(itemdetails);
        loadtabledata(itemdetails);
        clear();
       total+= price;
        $("#lblTotal").text(total);
    });
    $("#btnClearTable").click(function () {
        $("#OrderTable").remove();
        $("#lblTotal").text("");

    });
    $("#txtDiscount").keyup(function () {
        let payment = $("#txtPayment").val();
        let discount = $("#txtDiscount").val();
        let price=total-discount;
        $("#txtBalance").val(payment-price);
    });
    $("#btnPlaceOrder").click(function () {
        let orderId=$("#txtO_Id").val();
        let date=$("#txtO_Date")
        let itemId = $("#txtI_Id").val();
        let custid=$("#txtC_Id").val();

        var order=new OrderDto(orderId,date,custid,total);
        placeOrder(order);
        updateqty(itemList);
        AddOrder(itemList);

        itemList.splice(0,itemList.length);
    });


</script>

<script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>


</body>
</html>